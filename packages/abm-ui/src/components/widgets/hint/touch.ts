import { Signal } from '@lit-labs/signals';
import { css } from 'abm-utils';
import CSS from 'hint-touch.style';
import { html } from 'lit';
import { customElement, property } from 'lit/decorators.js';
import { Widget } from '../base';

export type WidgetHintTouchKey =
	| 'Tap'
	| 'DualTap'
	| 'Hold'
	| 'Move'
	| 'SwapUp'
	| 'SwapRight'
	| 'SwapDown'
	| 'SwapLeft';

export interface WidgetHintTouchProp {
	key?: WidgetHintTouchKey;
}

const KEYS: WidgetHintTouchKey[] = [
	'Tap',
	'DualTap',
	'Hold',
	'Move',
	'SwapUp',
	'SwapRight',
	'SwapDown',
	'SwapLeft',
];

@customElement('w-hint-touch')
export class WidgetHintTouch extends Widget<WidgetHintTouchProp> {
	static styles = css(CSS);
	#initialized = false;
	protected render() {
		return html`
			<svg class="${this.#key.get()}" width="28" height="28" viewBox="0 0 28 28">
				<circle class="tap" cx="28.94166" cy="12.672679" r="7.409163" transform="matrix(0.6185335,0,0,0.6185335,-1.8674543,-2.0745909)"/>
				<circle class="tap-2" cx="28.94166" cy="12.672679" r="4.800302" transform="matrix(0.6185335,0,0,0.6185335,-1.8674543,-2.0745909)"/>
				<path class="up" d="m 24.962452,9.236408 4,-4.0000001 4,4.0000001" transform="matrix(0.6185335,0,0,0.6185335,-1.8674543,-2.0745909)"/>
				<path class="right" d="m 34.040588,18.361418 4,-4 -4,-4" transform="matrix(0.6185335,0,0,0.6185335,-1.8674543,-2.0745909)"/>
				<path class="down" d="m 24.962452,4.736 4,4.0000001 4,-4.0000001" transform="matrix(0.6185335,0,0,0.6185335,-1.8674543,-2.0745909)"/>
				<path class="left" d="m 23.903848,18.361 -4,-4 4,-4" transform="matrix(0.6185335,0,0,0.6185335,-1.8674543,-2.0745909)"/>
				<path class="hand" d="m 25.881815,21.540528 -9.380569,1.881814 c -0.532231,0.114049 -1.031198,0.308883 -1.4969,0.584503 -0.465701,0.27562 -0.860122,0.61777 -1.183263,1.02645 -0.32314,0.408675 -0.579751,0.864872 -0.769833,1.368589 -0.190083,0.503722 -0.285124,1.031201 -0.285124,1.582437 v 6.899996 c 0,0.228097 0.04277,0.589254 0.128303,1.08347 0.08554,0.494211 0.20909,0.997928 0.370661,1.511151 0.161569,0.513223 0.351652,0.964669 0.570247,1.354338 0.218595,0.389669 0.470454,0.584503 0.755577,0.584503 0.152066,0 0.289876,-0.05702 0.413429,-0.171073 0.123555,-0.114049 0.185332,-0.247106 0.185332,-0.399172 0,-0.05703 -0.06653,-0.223349 -0.199586,-0.498967 -0.133059,-0.27562 -0.275621,-0.598761 -0.427687,-0.969423 -0.152066,-0.370658 -0.294628,-0.779336 -0.427686,-1.226033 -0.133057,-0.446693 -0.199586,-0.869624 -0.199586,-1.268794 v -6.899996 c 0,-0.418181 0.07128,-0.817354 0.213843,-1.197517 0.142561,-0.380167 0.337396,-0.722317 0.584505,-1.026449 0.247106,-0.304128 0.541733,-0.56074 0.883881,-0.769836 0.342149,-0.209089 0.71281,-0.351649 1.111983,-0.42768 l 9.865279,-1.967358 c 0.304132,-0.05703 0.456198,-0.247108 0.456198,-0.570244 v -9.209494 c 0,-0.532231 0.18533,-0.983677 0.55599,-1.354338 0.370661,-0.37066 0.822107,-0.55599 1.354337,-0.55599 0.532231,0 0.983677,0.18533 1.354339,0.55599 0.370659,0.370661 0.555989,0.822107 0.555989,1.354338 v 19.41692 c 0,0.152066 0.05702,0.285123 0.171076,0.399172 0.114049,0.114052 0.247106,0.171078 0.399171,0.171078 0.152067,0 0.289877,-0.05703 0.41343,-0.171078 0.123555,-0.114049 0.185333,-0.247106 0.185333,-0.399172 v -5.18925 c 0.608263,0.133059 1.097724,0.441944 1.468384,0.926655 0.370663,0.484707 0.555994,1.031192 0.555994,1.639457 v 5.930574 c 0,0.437191 -0.08554,0.860125 -0.256614,1.268801 -0.171073,0.408675 -0.41818,0.765078 -0.74132,1.069211 l -4.70454,4.64752 c -0.228099,0.209091 -0.403925,0.46095 -0.527478,0.755577 -0.123555,0.294626 -0.185333,0.603509 -0.185333,0.926648 v 3.193389 c 0,0.152066 0.05702,0.289874 0.171076,0.413424 C 27.934702,47.938223 28.06776,48 28.219826,48 c 0.152066,0 0.275619,-0.03802 0.37066,-0.114052 0.09505,-0.07603 0.161576,-0.175828 0.199587,-0.299378 0.03802,-0.123554 0.06178,-0.251861 0.07128,-0.384921 0.0095,-0.133059 0.01427,-0.256613 0.01427,-0.370662 0,-0.323138 -0.01426,-0.651029 -0.04277,-0.983674 -0.02851,-0.332645 -0.04277,-0.660537 -0.04277,-0.983676 0,-0.247108 0.01901,-0.513225 0.05702,-0.798351 0.03802,-0.285121 0.152069,-0.522723 0.342148,-0.712807 l 4.704542,-4.647514 c 0.418181,-0.418181 0.746073,-0.902892 0.983676,-1.454132 0.237603,-0.551236 0.356405,-1.121483 0.356405,-1.71074 v -5.930574 c 0,-0.456195 -0.08078,-0.898135 -0.242356,-1.325821 -0.161575,-0.427683 -0.384925,-0.807846 -0.670049,-1.14049 -0.285123,-0.332645 -0.62252,-0.613017 -1.01219,-0.841118 -0.389668,-0.228098 -0.812601,-0.380162 -1.268799,-0.456192 V 12.815743 c 0,-0.418181 -0.08079,-0.812603 -0.242356,-1.183264 -0.161571,-0.37066 -0.384918,-0.698552 -0.670041,-0.983675 C 30.84296,10.36368 30.515068,10.140333 30.144407,9.978762 29.773747,9.8171927 29.379183,9.736408 28.961,9.736408 c -0.41818,0 -0.812458,0.080785 -1.183119,0.242354 -0.37066,0.161571 -0.698552,0.384918 -0.983676,0.670042 -0.285125,0.285123 -0.508472,0.613015 -0.670043,0.983675 -0.161569,0.370661 -0.242353,0.765083 -0.242353,1.183264 z" transform="matrix(0.6185335,0,0,0.6185335,-1.8674543,-2.0745909)"/>
			</svg>
		`;
	}
	connectedCallback(): void {
		super.connectedCallback();
		if (this.#initialized) return;
		this.#initialized = true;
		this.key = this.textContent?.trim() as WidgetHintTouchKey;
	}
	#key = new Signal.State<WidgetHintTouchKey | undefined>(undefined);
	@property({ type: String })
	get key() {
		return this.#key.get();
	}
	set key(value) {
		if (this.#key.get() === value) return;
		this.#initialized = true;

		if (!value) value = undefined;
		else if (!KEYS.includes(value)) return;

		this.#key.set(value);
	}
	cloneNode(deep?: boolean): WidgetHintTouch {
		const node = super.cloneNode(deep) as WidgetHintTouch;

		node.key = this.key;

		return node;
	}
}
